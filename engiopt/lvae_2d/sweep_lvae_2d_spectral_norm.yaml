# Spectral Normalization Isolation Sweep
# Goal: Understand the effect of spectral norm independent of pruning method
# Keep pruning parameters fixed, vary only spectral norm

method: grid
metric:
  name: val_rec
  goal: minimize

parameters:
  # Problem
  problem_id:
    value: heatconduction2d

  # Fixed training parameters
  n_epochs:
    value: 2500
  batch_size:
    value: 128
  lr:
    value: 0.0001

  # Fixed LVAE parameters
  latent_dim:
    value: 250
  w_v:
    value: 0.01
  eta:
    value: 0.0001
  polynomial_schedule_n:
    value: 100
  polynomial_schedule_p:
    value: 2
  pruning_epoch:
    value: 500
  beta:
    value: 0.9
  resize_dimensions:
    value: [100, 100]

  # Fixed pruning strategy (test one at a time)
  pruning_strategy:
    value: plummet  # or lognorm

  # Fixed pruning parameters (use "good" defaults from initial sweeps)
  plummet_threshold:
    value: 0.02
  alpha:
    value: 0.2
  percentile:
    value: 0.05

  # EXPERIMENT: Spectral normalization only
  use_spectral_norm:
    values: [false, true]

  # Safeguards: DISABLED
  min_active_dims:
    value: 0
  # max_prune_per_epoch: omit to use code default (None)
  cooldown_epochs:
    value: 0
  k_consecutive:
    value: 1
  # recon_tol: omit to use code default (float('inf'))

  # Unused
  cdf_threshold:
    value: 0.95
  temperature:
    value: 1.0

  # Tracking
  track:
    value: true
  save_model:
    value: false
  wandb_project:
    value: lvae
  wandb_entity:
    value: null

  # More seeds for statistical power since this is a small sweep
  seed:
    values: [1, 2, 3, 4, 5]

program: engiopt/lvae_2d/lvae_2d.py
