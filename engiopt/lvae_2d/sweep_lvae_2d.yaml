# Scientific LVAE Sweep: Isolating Pruning Method & Spectral Normalization Effects
# Focus: plummet vs lognorm hyperparameters + spectral norm impact
# No safeguards initially - we want to see failures to understand behavior

method: grid  # Use grid for complete coverage of key interactions
metric:
  name: val_rec
  goal: minimize

parameters:
  # Problem - override via command line for each problem sweep
  problem_id:
    value: heatconduction2d  # Change per problem: beams2d, heatconduction2d, etc.

  # Fixed training parameters (keep constant to isolate pruning effects)
  n_epochs:
    value: 2500
  batch_size:
    value: 128
  lr:
    value: 0.0001

  # Fixed LVAE parameters
  latent_dim:
    value: 250
  w_v:
    value: 0.01
  eta:
    value: 0.0001
  polynomial_schedule_n:
    value: 100
  polynomial_schedule_p:
    value: 2
  pruning_epoch:
    value: 500
  beta:
    value: 0.9
  resize_dimensions:
    value: [100, 100]

  # PRIMARY EXPERIMENT 1: Pruning strategy comparison
  pruning_strategy:
    values: [plummet, lognorm]

  # Plummet hyperparameters - test wide range to find sensitivity
  plummet_threshold:
    values: [0.005, 0.01, 0.02, 0.05, 0.1, 0.2]

  # Lognorm hyperparameters
  alpha:
    values: [0.0, 0.1, 0.2, 0.3, 0.5]  # 0.0 = use only reference, 0.5 = blend equally
  percentile:
    values: [0.01, 0.02, 0.05, 0.1, 0.15, 0.2]

  # PRIMARY EXPERIMENT 2: Spectral normalization effect
  use_spectral_norm:
    values: [false, true]

  # Safeguards: DISABLED for initial scientific exploration
  min_active_dims:
    value: 0  # Allow complete pruning to see what happens
  # max_prune_per_epoch: null not supported in wandb sweeps - omit parameter to use code default (None)
  cooldown_epochs:
    value: 0  # No cooldown - immediate pruning when conditions met
  k_consecutive:
    value: 1  # Immediate pruning - no debouncing
  # recon_tol: inf - omit to use code default (float('inf'))

  # Unused parameters (for other pruning methods) - set to defaults
  cdf_threshold:
    value: 0.95
  temperature:
    value: 1.0

  # Tracking
  track:
    value: true
  save_model:
    value: false
  wandb_project:
    value: lvae
  wandb_entity:
    value: null

  # Multiple seeds for statistical significance
  seed:
    values: [1, 2, 3]

program: engiopt/lvae_2d/lvae_2d.py
